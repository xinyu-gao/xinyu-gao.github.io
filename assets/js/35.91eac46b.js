(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{561:function(s,t,e){"use strict";e.r(t);var a=e(2),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),e("h2",{attrs:{id:"开放-docker-守护进程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开放-docker-守护进程"}},[s._v("#")]),s._v(" 开放 Docker 守护进程")]),s._v(" "),e("p",[s._v("开放守护进程的访问，通过 TCP 套接字获取访问权限，向所有能连接宿主主机的人开放，默认 2375 端口。")]),s._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),e("p",[s._v("直接在云服务器上开放此端口号，百分之百会被黑客入侵，一定要慎重。\n如果你开放之后总是多出莫名的容器或者镜像，那就是被入侵了。")])]),s._v(" "),e("p",[s._v("所以我们选择开放其他的端口号（2379），更安全的做法是添加 IP 名单，和添加 TLS 证书。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开 Docker 配置文件")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/docker.service\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将此行的 dockerd 后添加 -H tcp://0.0.0.0:2379")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/ -H fd:// -H --containerd"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/containerd/containerd.sock\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改后")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd -H tcp://0.0.0.0:2379 fd:// --containerd"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/containerd/containerd.sock\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("Docker 配置文件找不到的话，可以去\n"),e("code",[s._v("/lib/systemd/system/docker.service")]),s._v(" 里找一下。")]),s._v(" "),e("p",[s._v("如果使用的不是 systemctl 配置文件的话，"),e("code",[s._v("/etc/default/docker")]),s._v("（Ubuntu、Deepin） 或者\n"),e("code",[s._v("/etc/sysconfg/docker")]),s._v("（CentOS、Red Hat）里找一下")])]),s._v(" "),e("p",[s._v("然后重新加载 docker 配置确保 systemd 守护进程采用了这个修改：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ systemctl daemon-reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("重启Docker：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ systemctl restart docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);t.default=r.exports}}]);